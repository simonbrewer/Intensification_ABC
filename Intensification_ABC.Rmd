---
title: "ABC_PopDynamic_Plateau_Basin"
author: "Kurt M. Wilson & Simon C. Brewer"
date: "2022-10-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load the libraries
```{r}
library(viridis)
library(scales)
```


Read in data
```{r}

GB.mc.sum <- read.csv("Basin_bootstrapped_spd.csv")
colnames(GB.mc.sum) <- c("X", "calBP", "SPD_mean", "SPD_lowerCI", "SPD_upperCI")

CP.mc.sum <- read.csv("Plateau_bootstrapped_spd.csv")
colnames(CP.mc.sum) <- c("X", "calBP", "SPD_mean", "SPD_lowerCI", "SPD_upperCI")

CP_precip.df <- read.csv("Plateau_avg_precip_mo.csv")
GB_precip.df <- read.csv("Basin_avg_precip_mo.csv")

```

Notes about the data
- SPD data is all radiocarbon dates from the region (subset by the the outer boundaries of the watersheds), with any date with an error of > 100 removed. The 14c dates were then calibrated using rcarbon and the intcal20 calibration curve. They are placed into 1,000 year bins and the SPDs are made using a running 100 year average. We use all dates that are 5000 years or younger. The SPD data here as a csv is SPD data generated by monte carlo style resampling. I generated 100 SPDs, each time using 25% of the data (so for the Plateau where n = 6698 we use 1675 dates for each SPD). The 25% of the data is randomly sampled. From that I can get the mean SPD as well as CIs - here we do 99% CIs
- Climate data (here just precipitation) is obtained from Lorenz et al 2016 Downscaled and debiased climate simulations for North America from 21,000 years ago to 2100AD in Scientific data 3(1), 1-19. The precipitation data is available on a per month basis at 0.5 x 0.5 degree lat/lon grid cells. Since we are treating the entire regions as the unit of study, I have aggregated the data to get the average. This entails getting the average precip across all of the cells within the region for each month and then averaging the 12 months together. This is done for each decadal time step. Thus, what we have to analyze, is the average monthly precipitation per decade for the entire study period for both the Great Basin and the Colorado Plateau.

Plot the SPDs
```{r}

cp.col <- rgb(59, 15, 112, max = 255)#purple
gb.col <- rgb(96,206,172, max = 255)#teal


plot(NA,
     xlim=c(0,5000),
     ylim=c(0,0.8),
     xlab="Year cal. BP",
     ylab="Population Density (SPD)"
)


with(GB.mc.sum,
        lines(SPD_mean~calBP,
             lwd=1,
             col = gb.col)
)

polygon(y=c(GB.mc.sum$SPD_lowerCI, rev(GB.mc.sum$SPD_upperCI)),
        x=c(GB.mc.sum$calBP, rev(GB.mc.sum$calBP)),
        col=alpha(gb.col, alpha=0.5),
        border = NA
        )

with(CP.mc.sum,
        lines(SPD_mean~calBP,
             lwd=1,
             col = cp.col)
)

polygon(y=c(CP.mc.sum$SPD_lowerCI, rev(CP.mc.sum$SPD_upperCI)),
        x=c(CP.mc.sum$calBP, rev(CP.mc.sum$calBP)),
        col=alpha(cp.col, alpha=0.5),
        border = NA
        )

```

Plot the averaged precip per month for each of the regions
```{r}
plot(CP_precip.df$Mo_Avg~CP_precip.df$Year, type = "l", lwd = 2, col = cp.col, ylim = c(22, 34))
lines(GB_precip.df$Mo_Avg~GB_precip.df$Year, lwd = 2, col = gb.col)

```

Dinapoli equation might be nice for what we want to do. It is still logistic growth, but means we only have to alter k in one area which makes for easier reading and implementation.
```{r}

#N = Np * exp(r * (1-(Np / Kp)))
#N = population size at time now
#Np = population size at prior time step
#r = growth rate
#Kp = carrying capacity at prior time step

#Kp = exp(clim * precip + sei)
#clim = the influence / impact of climate on k
#sei = the influence of subsistence economic intensification on k

#sei should be decomposed into a couple of things here as well. 1 = the binary for has it begun yet (0/1 depending on if we have hit the start year) and the amount of sei that has occurred. This could be done in several ways - either as its own growth model so that sei can increase, as a constant that increases each time step after SEI begins, or the third thing Simon & I spoke about (check notes)



N <- 0.005

pop.df <- data.frame()

for (i in 1:500){

pop <- N * exp(0.05 * (1 - (N / 50)))
N <- pop
pop.t <- data.frame(Time = i, Pop = N)
pop.df <- rbind(pop.df, pop.t)
}


plot(pop.df$Pop~pop.df$Time, type = "l")


```


Below is the version of the logistic growth equation used by Porcic et al. 2016 & 2021
```{r}

Pop <- function(k,p0,r,t){
  (k*p0*exp(r*t)) / (k +(p0*(exp(r*t) - 1)))
}

#k = carrying capacity (we will decompose this to be climate and intensification)
#this is also where we can put the if intensification has begun yet or not
#p0 = population at time 0
#r = population growth rate
#t = current time step



plot(Pop(5000, 2, 0.005, seq(0,5000,10)), type = "l")

plot(Pop(5000, 2, 0.0025, seq(0,5000,10)), type = "l")

```     
